---
import { contenidoProcesos } from '../data/contenidoProcesos.js';
---

<section class="seccion-procesos" id="procesos">
  <div class="contenedor">
    <div class="encabezado-seccion">
      <h2 class="titulo-seccion">Nuestros Procesos</h2>
      <p class="subtitulo-seccion">
        Más de 35 años perfeccionando cada etapa del proceso metalúrgico
      </p>
    </div>

    <div class="grid-procesos">
      {contenidoProcesos.map((proceso, index) => (
        <div class="tarjeta-proceso" data-proceso-id={proceso.id} style={`--card-delay: ${index * 50}ms`}>
          <div class="contenedor-imagen">
            <div class="imagen-overlay"></div>
            {proceso.imagenes.map((imagen, imgIndex) => (
              <img
                src={imagen}
                alt={`${proceso.nombre} - imagen ${imgIndex + 1}`}
                class={`imagen-proceso ${imgIndex === 0 ? 'activa' : ''}`}
                loading="lazy"
                data-index={imgIndex}
              />
            ))}
            <div class="indicadores-imagenes">
              {proceso.imagenes.map((_, imgIndex) => (
                <div class={`indicador-imagen ${imgIndex === 0 ? 'activo' : ''}`} data-img={imgIndex}></div>
              ))}
            </div>
          </div>
          <div class="info-tarjeta">
            <div class="numero-proceso">{String(proceso.id).padStart(2, '0')}</div>
            <h3 class="nombre-proceso">{proceso.nombre}</h3>
            <p class="descripcion-proceso">{proceso.descripcion}</p>
            <div class="barra-inferior"></div>
          </div>
        </div>
      ))}
    </div>
  </div>
</section>

<style>
.seccion-procesos {
  padding: 40px 0;
  background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
  overflow: hidden;
}

.contenedor {
  max-width: 1400px;
  margin: 0 auto;
  padding: 0 20px;
}

.encabezado-seccion {
  text-align: center;
  margin-bottom: 60px;
  animation: fadeInDown 0.8s ease-out;
}

@keyframes fadeInDown {
  from {
    opacity: 0;
    transform: translateY(-20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.titulo-seccion {
  font-size: 3rem;
  font-weight: 700;
  color: #0F4E67;
  margin: 0 0 16px 0;
  font-family: 'Roboto Condensed', sans-serif;
  letter-spacing: -1px;
}

.subtitulo-seccion {
  font-size: 1.1rem;
  color: #64748b;
  margin: 0;
  max-width: 600px;
  margin-left: auto;
  margin-right: auto;
  font-weight: 300;
  letter-spacing: 0.3px;
}

.grid-procesos {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 28px;
  margin-bottom: 40px;
}

.tarjeta-proceso {
  background: white;
  border-radius: 20px;
  overflow: hidden;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.06);
  transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
  cursor: pointer;
  display: flex;
  flex-direction: column;
  position: relative;
  animation: slideUp 0.6s ease-out forwards;
  animation-delay: var(--card-delay, 0ms);
  opacity: 0;
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.tarjeta-proceso:hover {
  transform: translateY(-12px);
  box-shadow: 0 20px 60px rgba(15, 78, 103, 0.12);
}

.tarjeta-proceso::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, rgba(15, 78, 103, 0) 0%, rgba(15, 78, 103, 0.03) 100%);
  pointer-events: none;
  opacity: 0;
  transition: opacity 0.4s ease;
}

.tarjeta-proceso:hover::before {
  opacity: 1;
}

.contenedor-imagen {
  position: relative;
  width: 100%;
  height: 200px;
  /* height: 240px; */
  overflow: hidden;
  background: linear-gradient(135deg, #f0f4f8 0%, #e8eef7 100%);
}

.imagen-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: radial-gradient(circle at center, transparent 0%, rgba(15, 78, 103, 0.1) 100%);
  z-index: 2;
  pointer-events: none;
}

.imagen-proceso {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  opacity: 0;
  transition: opacity 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.imagen-proceso.activa {
  opacity: 1;
}

.indicadores-imagenes {
  position: absolute;
  bottom: 12px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 6px;
  z-index: 3;
  background: rgba(0, 0, 0, 0.3);
  padding: 8px 12px;
  border-radius: 20px;
  backdrop-filter: blur(8px);
}

.indicador-imagen {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.4);
  transition: all 0.3s ease;
  cursor: pointer;
}

.indicador-imagen.activo {
  background: white;
  width: 24px;
  border-radius: 4px;
}

.info-tarjeta {
  /* padding: 32px 24px 24px; */
  padding: 10px 20px 10px;
  flex: 1;
  display: flex;
  flex-direction: column;
  position: relative;
}

.numero-proceso {
  font-size: 2rem;
  font-weight: 700;
  color: #c6c7c9;
  /* color: #6d6e71; */
  /* COLOR: rgba(15, 78, 103, 0.12); */
  line-height: 1;
  margin: 0 0 8px 0;
  font-family: 'Roboto Condensed', sans-serif;
}

.nombre-proceso {
  font-size: 1.3rem;
  font-weight: 700;
  color: #0F4E67;
  margin: 0 0 12px 0;
  font-family: 'Roboto Condensed', sans-serif;
  letter-spacing: -0.5px;
}

.descripcion-proceso {
  font-size: 0.95rem;
  color: #64748b;
  line-height: 1.7;
  margin: 0 0 auto 0;
  font-weight: 400;
}

.barra-inferior {
  height: 3px;
  background: linear-gradient(90deg, #0F4E67 0%, #1e7a96 100%);
  margin-top: 16px;
  border-radius: 2px;
  transform: scaleX(0);
  transform-origin: left;
  transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.tarjeta-proceso:hover .barra-inferior {
  transform: scaleX(1);
}

/* Responsive Design */

@media (max-width: 1200px) {
  .grid-procesos {
    grid-template-columns: repeat(3, 1fr);
    gap: 24px;
  }

  .titulo-seccion {
    font-size: 2.8rem;
  }
}

@media (max-width: 900px) {
  .seccion-procesos {
    padding: 60px 0;
  }

  .titulo-seccion {
    font-size: 2.4rem;
  }

  .subtitulo-seccion {
    font-size: 1rem;
  }

  .grid-procesos {
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
  }

  .contenedor-imagen {
    height: 220px;
  }

  .numero-proceso {
    font-size: 2.5rem;
  }

  .nombre-proceso {
    font-size: 1.2rem;
  }

  .info-tarjeta {
    padding: 28px 22px 20px;
  }
}

@media (max-width: 768px) {
  .contenedor {
    padding: 0;
  }

  .encabezado-seccion {
    margin-bottom: 40px;
    padding: 0 20px;
  }

  .titulo-seccion {
    font-size: 2rem;
  }

  .subtitulo-seccion {
    font-size: 0.95rem;
  }

  .grid-procesos {
    display: flex;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    scroll-behavior: smooth;
    gap: 0;
    margin-bottom: 20px;
    padding: 0 20px;
    -webkit-overflow-scrolling: touch;
    grid-template-columns: unset;
  }

  .grid-procesos::before{
    content: '';
    flex: 0 0 calc((100vw - 80px) / 2);
  }

  .grid-procesos::-webkit-scrollbar {
    display: none;
  }

  .tarjeta-proceso {
    flex: 0 0 calc(100vw - 40px);
    scroll-snap-align: center;
    margin-right: 16px;
    animation: none;
    opacity: 1;
  }

  .tarjeta-proceso:last-child {
    margin-right: 20px;
  }

  .contenedor-imagen {
    height: 200px;
  }

  .numero-proceso {
    font-size: 2rem;
  }

  .nombre-proceso {
    font-size: 1.1rem;
  }

  .info-tarjeta {
    padding: 24px 20px 20px;
  }

  .descripcion-proceso {
    font-size: 0.9rem;
    line-height: 1.6;
  }

  .indicadores-imagenes {
    bottom: 10px;
    padding: 6px 10px;
  }

  .indicador-imagen {
    width: 6px;
    height: 6px;
  }

  .indicador-imagen.activo {
    width: 20px;
  }
}

@media (max-width: 480px) {
  .titulo-seccion {
    font-size: 1.8rem;
  }

  .subtitulo-seccion {
    font-size: 0.9rem;
  }

  .contenedor {
    padding: 0;
  }

  .encabezado-seccion {
    padding: 0 16px;
    margin-bottom: 32px;
  }

  .tarjeta-proceso {
    flex: 0 0 calc(100vw - 64px);
    margin-right: 12px;
  }

  .tarjeta-proceso:last-child {
    margin-right: 16px;
  }

  .grid-procesos {
    padding: 0 16px;
  }

  .contenedor-imagen {
    height: 180px;
  }

  .numero-proceso {
    font-size: 1.8rem;
  }

  .nombre-proceso {
    font-size: 1rem;
  }

  .info-tarjeta {
    padding: 20px 16px 16px;
  }

  .descripcion-proceso {
    font-size: 0.85rem;
  }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const tarjetas = document.querySelectorAll('.tarjeta-proceso');
  const esMovil = window.innerWidth <= 768;

  tarjetas.forEach((tarjeta) => {
    const imagenes = tarjeta.querySelectorAll('.imagen-proceso');
    const indicadores = tarjeta.querySelectorAll('.indicador-imagen');
    let indiceActual = 0;
    let intervalo = null;

    function actualizarIndicadores() {
      indicadores.forEach((ind, index) => {
        ind.classList.toggle('activo', index === indiceActual);
      });
    }

    function cambiarImagen() {
      imagenes[indiceActual].classList.remove('activa');
      indiceActual = (indiceActual + 1) % imagenes.length;
      imagenes[indiceActual].classList.add('activa');
      actualizarIndicadores();
    }

    function iniciarRotacion() {
      if (intervalo) return;
      intervalo = setInterval(cambiarImagen, 700);
    }

    function detenerRotacion() {
      if (intervalo) {
        clearInterval(intervalo);
        intervalo = null;
      }
      imagenes.forEach(img => img.classList.remove('activa'));
      imagenes[0].classList.add('activa');
      indiceActual = 0;
      actualizarIndicadores();
    }

    indicadores.forEach((indicador, index) => {
      indicador.addEventListener('click', () => {
        if (intervalo) {
          clearInterval(intervalo);
          intervalo = null;
        }
        imagenes[indiceActual].classList.remove('activa');
        indiceActual = index;
        imagenes[indiceActual].classList.add('activa');
        actualizarIndicadores();
      });
    });

    if (!esMovil) {
      tarjeta.addEventListener('mouseenter', iniciarRotacion);
      tarjeta.addEventListener('mouseleave', detenerRotacion);
    }
  });

  if (esMovil) {
    const gridProcesos = document.querySelector('.grid-procesos');

    gridProcesos.addEventListener('scroll', () => {
      tarjetas.forEach((tarjeta) => {
        const rect = tarjeta.getBoundingClientRect();
        const gridRect = gridProcesos.getBoundingClientRect();
        const centroTarjeta = rect.left + rect.width / 2;
        const centroGrid = gridRect.left + gridRect.width / 2;
        const distancia = Math.abs(centroTarjeta - centroGrid);

        if (distancia < rect.width / 3) {
          tarjeta.style.opacity = '1';
          tarjeta.style.transform = 'scale(1)';
        } else {
          tarjeta.style.opacity = '0.7';
          tarjeta.style.transform = 'scale(0.95)';
        }
      });
    }, { passive: true });
  }
});
</script>